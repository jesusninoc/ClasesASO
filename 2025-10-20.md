# Contenido de la clase

- Procesos e hilos https://www.jesusninoc.com/04/04/mostrar-los-hilos-que-se-estan-ejecutando-en-relacion-con-los-servicios-los-procesos-y-los-puertos-abiertos-tcp/
- Servicios https://www.jesusninoc.com/11/10/analizar-servicios-con-powershell/
- UEFI y tarea avanzada (arranque UEFI, gestor de arranque, arranque seguro, quitar contraseña https://www.youtube.com/watch?v=HkoAtiY7tmc)
- Acceso remoto: SSH, RDP, SCP
- Enter-PSSession -ComputerName EQUIPO
- Túnel SSH (Putty)
- Impresión (CUPS, impresión desde PowerShell) https://github.com/jesusninoc/ClasesASO/blob/master/2024-01-16.md
- VPN https://www.wireguard.com/install/
- Añadir Ubuntu Server al AD.
```
### Tener instalado un AD en Windows Server
- IP fija y sin puerta de enlace.
- Nombre de servidor (dc01).

### DNS en Ubuntu
sudo nano /etc/systemd/resolved.conf

[Resolve]
DNS=192.168.1.10
Domains=power.local

sudo systemctl restart systemd-resolved

dig power.local

### realm
sudo apt update
sudo apt install realmd sssd krb5-user samba-common-bin oddjob oddjob-mkhomedir adcli
# Configuración de krb5 -> nombre de Dominio POWER.LOCAL
# Configuring Kerberos Authentication ├──────────────────────────────┐
#   │ When users attempt to use Kerberos and specify a principal or user name without specifying what   │ 
#   │ administrative Kerberos realm that principal belongs to, the system appends the default realm.    │ 
#   │ The default realm may also be used as the realm of a Kerberos service running on the local        │ 
#   │ machine.  Often, the default realm is the uppercase version of the local DNS domain.              │ 
#   │                                                                                                   │ 
#   │ Default Kerberos version 5 realm:                          

realm discover POWER.LOCAL

sudo realm join --user=Administrador POWER.LOCAL
# Errores: journalctl REALMD_OPERATION=r1208.3124
# - Reloj
# - Contraseña mal puesta

realm list
```
- Crear recurso compartido en Ubuntu Server para ver desde Windows (compartir, permisos, c$, localhost)
- Kerberos en funcionamiento.
```
### Iniciar sesión
sudo systemctl status sssd

# Home para el usuario
sudo pam-auth-update
# PAM profiles to enable:                                                                            │ 
#  │                                                                                                    │ 
#  │  [*] Pwquality password strength checking                                                          │ 
#  │  [ ] SSS required smart card authentication                                                        │ 
#  │  [ ] SSS optional smart card authentication                                                        │ 
#  │  [*] Unix authentication                                                                           │ 
#  │  [*] SSS authentication                                                                            │ 
#  │  [*] Register user sessions in the systemd control group hierarchy                                 │ 
#  │  [*] Create home directory on login                                                                │ 
#  │  [*] Inheritable Capabilities Management  

kinit usuario@POWER.LOCAL
klist

id usuario@power.local

ssh 'usuario@POWER.LOCAL'@localhost

### Objetos LDAP con ldapsearch
sudo apt install ldap-utils

ldapsearch -x -H ldap://WIN-8TBGIF849CB.power.local -D "usuario@POWER.LOCAL" -W -b "dc=power,dc=local"
```
- Instala Zabbix Server y agente en un Windows y un Linux. Crea un trigger para alertar si CPU > 80%.
```
# Instalación del Zabbix Agent en Windows

- Descarga el agente desde:
https://www.zabbix.com/download_agents

- Extrae el archivo descargado y abre una terminal (cmd) en la carpeta donde está el agente.

- Ejecuta estos comandos para instalar el agente como servicio y arrancarlo:

zabbix_agentd.exe --config zabbix_agentd.conf --install
zabbix_agentd.exe --start

- Edita el archivo zabbix_agentd.conf y configura estas líneas:

Server=IP_DEL_ZABBIX
ServerActive=IP_DEL_ZABBIX
Hostname=NOMBRE_DEL_HOST

# Crear un trigger para alertar si la CPU > 80%

- A. Accede a la interfaz web de Zabbix desde el navegador:

http://IP_DEL_SERVIDOR/zabbix

Usuario: Admin
Contraseña: zabbix

- B. Agrega hosts

En el menú, ve a: Configuration > Hosts > Create host

Crea un host para Linux y otro para Windows.

Asocia estas plantillas a cada host según corresponda:
Template OS Linux by Zabbix agent
Template OS Windows by Zabbix agent

- C. Crear trigger personalizado

Ve a: Configuration > Hosts > Triggers

Selecciona el host al que quieres añadir el trigger.

Haz clic en Create trigger.

Configura los siguientes campos:

Nombre: Alta carga de CPU (>80%)
Severidad: High
Expresión: {NombreDelHost:system.cpu.util[,user].last()}>80

Alternativa para la métrica total agregada:

{NombreDelHost:system.cpu.util[].last()}>80

Guarda el trigger.
```

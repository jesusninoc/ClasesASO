# Preguntas test (de todos los temas)

¿Para qué sirve el comando ssh-keygen -t rsa -b 4096?
a) Para copiar archivos al servidor
b) Para generar un par de claves SSH (pública y privada) de tipo RSA de 4096 bits
c) Para cambiar la contraseña del usuario

En ssh-keygen -t rsa -b 4096, la opción -b 4096 indica:
a) El número de intentos de conexión
b) El tamaño en bits de la clave que se va a crear
c) El número de puertos a abrir

¿Qué hace el comando ssh-copy-id usuario@ip_del_servidor?
a) Copia un archivo al servidor
b) Copia la clave privada al servidor
c) Copia la clave pública al servidor para poder iniciar sesión sin contraseña

Después de ejecutar ssh-copy-id usuario@ip_del_servidor correctamente, normalmente podrás:
a) Conectarte por SSH sin tener que escribir la contraseña cada vez
b) Reiniciar automáticamente el servidor
c) Cambiar la IP del servidor

¿Qué hace el comando ssh usuario@ip_del_servidor?
a) Abre una sesión remota en el servidor por SSH
b) Copia archivos desde el servidor
c) Muestra la configuración de red del servidor

¿Qué necesitas haber hecho antes para que ssh usuario@ip_del_servidor no pida contraseña?
a) Haber hecho ping al servidor
b) Haber ejecutado ssh-keygen y luego ssh-copy-id
c) Haber reiniciado el servicio SSH en el servidor

¿Qué permite crear un túnel SSH desde el puerto 8080 local al puerto 80 de un servidor remoto?
a) Acceder al escritorio remoto
b) Redirigir el tráfico de localhost:8080 hacia el servidor remoto en su puerto 80
c) Enviar archivos por SCP

¿Para qué sirve acceder al servidor remoto usando localhost:8080 tras crear el túnel?
a) Para evitar el firewall del servidor
b) Para ver el servicio web del servidor remoto como si estuviera en tu equipo
c) Para reiniciar el servidor remoto

¿Qué tipo de túnel SSH permite usar el servidor remoto como salida a Internet?
a) Túnel local (L)
b) Túnel remoto (R)
c) Túnel dinámico (D), actuando como proxy SOCKS

¿Qué es necesario para instalar impresoras en Windows?
a) Instalar el rol “Print and Document Services”
b) Instalar Hyper-V
c) Instalar IIS

¿Cómo se denomina en Linux el sistema encargado de gestionar la impresión?
a) SMB
b) CUPS
c) NFS

¿Qué comando de PowerShell muestra los trabajos enviados a una impresora?
a) Show-Printer
b) Get-PrintJob
c) Printer-List

En Linux, ¿qué comando permite listar las impresoras configuradas?
a) lpstat -p
b) print-list
c) lsprinter

## Posibles preguntas (último tema)

¿Para qué se utiliza principalmente LDAP?
a) Para compartir carpetas entre Windows y Linux
b) Para acceder y consultar servicios de directorio
c) Para cifrar discos duros

¿Qué es Active Directory en relación con LDAP?
a) Un sistema de copias de seguridad
b) La implementación de Microsoft del estándar LDAP
c) Un servidor web de Microsoft

¿Qué protocolo usa Active Directory para la autenticación segura?
a) FTP
b) Kerberos
c) HTTP

¿Qué ventaja ofrece Kerberos frente a enviar la contraseña en cada conexión?
a) Usa tickets temporales y evita que la contraseña viaje por la red
b) Comprime los datos para que vayan más rápido
c) Cambia la contraseña automáticamente cada día

¿Para qué se utiliza DNS en un dominio con Active Directory?
a) Para compartir impresoras
b) Para localizar controladores de dominio y servicios
c) Para instalar actualizaciones de Windows

¿Qué componente en Linux actúa como “puente” con fuentes de identidad externas como AD o LDAP?
a) cron
b) SSSD
c) systemd

¿Qué herramienta de Samba permite a un sistema Linux usar usuarios y grupos de Active Directory?
a) Winbind
b) NFS
c) iptables

¿Qué comando ayuda a unir una máquina Linux a un dominio de forma sencilla?
a) top
b) realm (junto con adcli)
c) df

¿Qué comando se utiliza para obtener un ticket Kerberos para el usuario usuario@POWER.LOCAL?
a) kinit usuario@POWER.LOCAL
b) klist usuario@POWER.LOCAL
c) ssh usuario@POWER.LOCAL

¿Qué muestra el comando klist?
a) Los usuarios conectados al sistema
b) Los tickets Kerberos activos en la sesión
c) Los procesos que usan más CPU

¿Qué hace el comando ldapsearch en este contexto?
a) Buscar objetos en el servicio de directorio mediante LDAP
b) Escanear puertos abiertos en la red
c) Crear usuarios en Active Directory

En Samba, el parámetro valid users = @grupo_docs indica que pueden acceder a la carpeta compartida:
a) Solo los usuarios invitados
b) Solo el usuario root
c) Solo los usuarios pertenecientes al grupo grupo_docs

¿Qué ruta se utiliza desde Windows para acceder a la carpeta compartida docs en un servidor Samba?
a) C:\docs\servidor
b) \<IP_DEL_SERVIDOR>\docs
c) http://<IP_DEL_SERVIDOR>/docs

¿Qué comando en Linux permite comprobar si otro equipo de la red responde a nivel básico de conectividad?
a) ping <IP_DEL_EQUIPO>
b) ssh <IP_DEL_EQUIPO>
c) net use <IP_DEL_EQUIPO>

Si desde Windows no puedes montar \<IP_DEL_SERVIDOR>\docs, ¿qué comando puedes usar en el servidor Linux para probar el recurso Samba localmente?
a) smbclient //127.0.0.1/docs -U usuario1
b) ftp 127.0.0.1
c) telnet 127.0.0.1 80

¿Para qué sirve el comando Read-Host en PowerShell?
a) Para reiniciar un servicio
b) Para leer un dato introducido por el usuario por teclado
c) Para mostrar la lista de procesos

En Bash, ¿qué hace la instrucción read -p "CPU mínima: " valor?
a) Muestra el uso de CPU del sistema
b) Pide al usuario un dato y lo guarda en la variable valor
c) Ejecuta un script llamado valor

En PowerShell, ¿qué hace la variable $valor = Read-Host "CPU mínima"?
a) Asigna un valor fijo a la variable
b) Borra el contenido de la variable
c) Guarda en $valor lo que escriba el usuario

En PowerShell, ¿qué hace Get-Process?
a) Muestra los servicios instalados
b) Muestra los procesos que se están ejecutando en el sistema
c) Muestra los usuarios conectados

En PowerShell, ¿qué indica el operador -gt en la condición Where-Object { $_.CPU -gt $valor }?
a) Menor que
b) Igual que
c) Mayor que

En el comando de Bash ps -eo pid,comm,%cpu --no-headers, ¿qué hace ps?
a) Muestra procesos en ejecución
b) Muestra el espacio libre en disco
c) Muestra la configuración de red

En el script de Bash, ¿para qué se usa el bucle while en:
ps -eo pid,comm,%cpu --no-headers | while read pid nombre cpu; do ... done?
a) Para ejecutar el script una sola vez
b) Para leer línea a línea la salida de ps y procesar cada proceso
c) Para detener todos los procesos que se muestren

¿Cuál es una ventaja de usar scripts para monitorizar procesos?
a) Que siempre consumen mucha CPU
b) Que permiten automatizar comprobaciones repetitivas sin hacerlo manualmente
c) Que impiden ver los procesos del sistema

En un script de administración, ¿para qué sirve guardar resultados en un archivo de log?
a) Para borrar automáticamente los procesos antiguos
b) Para poder revisar después qué ha pasado y cuándo
c) Para acelerar la ejecución del script

En PowerShell, ¿qué hace Select-Object Id, ProcessName, CPU tras Get-Process?
a) Elimina los procesos que no usen CPU
b) Muestra únicamente las columnas Id, nombre del proceso y CPU
c) Cambia las prioridades de los procesos

En Bash, ¿qué se entiende por “script”?
a) Un archivo de texto con comandos que se ejecutan de forma automática
b) Un tipo especial de usuario
c) Una partición del disco duro

¿Qué hace el comando en PowerShell
Get-Process | Sort-Object CPU -Descending | Select-Object -First 5 Id, ProcessName, CPU?
a) Muestra todos los servicios instalados
b) Muestra los 5 procesos que más CPU consumen con su Id, nombre y CPU
c) Elimina los 5 procesos que más CPU usan

En el comando Sort-Object CPU -Descending, ¿qué significa -Descending?
a) Ordenar de menor a mayor
b) Ordenar alfabéticamente por nombre
c) Ordenar de mayor a menor

En Select-Object -First 5 Id, ProcessName, CPU, ¿qué hace -First 5?
a) Selecciona los últimos 5 procesos
b) Selecciona solo los 5 primeros resultados
c) Selecciona 5 procesos al azar

En PowerShell, ¿qué hace $servicio = Get-Service "Spooler"?
a) Instala el servicio Spooler
b) Guarda en la variable $servicio la información sobre el servicio Spooler
c) Detiene el servicio Spooler

En la condición if ($servicio.Status -eq "Stopped") { ... }, ¿qué comprueba el script?
a) Si el servicio está en ejecución
b) Si el servicio está detenido
c) Si el servicio está desinstalado

En el bloque Start-Service "Spooler", ¿qué ocurre?
a) Se desinstala el servicio Spooler
b) Se inicia el servicio Spooler si está detenido
c) Se reinicia el equipo

En PowerShell, ¿qué hace Get-Date?
a) Muestra solo la hora del sistema
b) Muestra la fecha y hora actuales
c) Cambia la fecha del sistema

En Out-File -FilePath "C:\mantenimiento.log" -Append, ¿para qué sirve -Append?
a) Sobrescribe el archivo borrando el contenido anterior
b) Añade la nueva línea al final del archivo sin borrar lo anterior
c) Crea una copia de seguridad del archivo

-------------
-------------

# Scripting
- Curso acelerado de PowerShell https://www.jesusninoc.com/11/22/curso-online-de-powershell-diciembre-2025/
- Cron y tarea programada.
- Copias de seguridad
```PowerShell
# Actividad: Programación de backups automáticos en Windows con PowerShell
# Este script:
#  - Comprime C:\Users en un ZIP con la fecha en el nombre
#  - Guarda el backup en D:\backups
#  - Añade una entrada a un archivo de log
#  - BONUS: Verifica con Test-Path y envía correo si el backup falla

# Carpeta de origen que se va a comprimir
$Origen  = "C:\Users"

# Carpeta de destino donde se guardarán los backups
$Destino = "D:\backups"

# Crear la carpeta de destino si no existe (Test-Path + New-Item)
if (-not (Test-Path $Destino)) {
    New-Item -ItemType Directory -Path $Destino | Out-Null
}

# Fecha en formato YYYY-MM-DD para el nombre del ZIP
$Fecha = Get-Date -Format "yyyy-MM-dd"

# Ruta completa del archivo ZIP de backup
$Zip   = Join-Path $Destino "backup-$Fecha.zip"

# Archivo de log donde se registran los resultados
$Log   = Join-Path $Destino "backup_diario.log"

# Configuración básica de correo (adaptar a cada entorno)
# Estos datos son de ejemplo y deben cambiarse por valores reales
$MailTo     = "admin@midominio.com"      # Destinatario del correo
$MailFrom   = "backup@midominio.com"     # Remitente del correo
$SmtpServer = "smtp.midominio.com"       # Servidor SMTP

# Comprimir la carpeta de usuarios en un ZIP (Compress-Archive)
Compress-Archive -Path $Origen -DestinationPath $Zip -Force

# Verificar con Test-Path si el fichero de backup se ha creado correctamente
if (Test-Path $Zip) {
    # Mensaje de log en caso de éxito
    $Mensaje = "$(Get-Date): Backup correcto en $Zip"
} else {
    # Mensaje de log en caso de error
    $Mensaje = "$(Get-Date): ERROR: no se ha creado el backup en $Zip"

    # BONUS: Enviar notificación por correo si el backup falla
    try {
        Send-MailMessage -To $MailTo -From $MailFrom -Subject "ERROR en backup diario" `
            -Body $Mensaje -SmtpServer $SmtpServer
    } catch {
        # Si falla el envío de correo, añadir también el error al log
        $Mensaje += " (además, error al enviar correo: $($_.Exception.Message))"
    }
}

# Escribir el mensaje (éxito o error) en el archivo de log
$Mensaje | Out-File -FilePath $Log -Append

# Ejemplo de programación en el Programador de tareas (Task Scheduler):
#  - Acción: Iniciar un programa
#  - Programa: powershell.exe
#  - Argumentos: -File "C:\Scripts\backup_diario.ps1"
#  - Hora de ejecución diaria: 23:00
```
```Bash
#!/bin/bash
# Actividad: Programación de backups automáticos en Linux
# Este script:
#  - Comprime /etc y /home
#  - Guarda el backup en /backups con la fecha en el nombre
#  - Registra el resultado en un archivo de log

# Directorio donde se guardan los backups
BACKUP_DIR="/backups"

# Archivo de log donde se registran los resultados
LOG="/var/log/backup_diario.log"

# Fecha en formato YYYY-MM-DD
FECHA=$(date +%F)

# Nombre del archivo de backup (tar.gz)
FICHERO="$BACKUP_DIR/backup-$FECHA.tar.gz"

# Crear la carpeta de backups si no existe
mkdir -p "$BACKUP_DIR"

# Comprimir /etc y /home en un solo fichero tar.gz
tar -czf "$FICHERO" /etc /home

# Comprobar si el comando anterior ha ido bien (código de salida 0 = OK)
if [ $? -eq 0 ]; then
    # Línea de log en caso de éxito
    echo "$(date): Backup correcto en $FICHERO" >> "$LOG"
else
    # Línea de log en caso de error
    echo "$(date): ERROR al crear el backup" >> "$LOG"
fi

# Ejemplo de línea de cron (para pegar en crontab de root con 'crontab -e'):
# 0 23 * * * /usr/local/sbin/backup_diario.sh
```
- Monitorizar VM
```PowerShell
# Hyper-V: detectar máquinas detenidas y mostrar una "alerta" simple
$stoppedVMs = Get-VM | Where-Object State -eq 'Off'

if ($stoppedVMs) {
    $stoppedVMs | ForEach-Object {
        Write-Warning "La VM de Hyper-V '$($_.Name)' está detenida."
    }

    # Aquí podrías añadir:
    # - Enviar un correo
    # - Escribir en el Visor de eventos
    # - Lanzar un popup, etc.
}
```
```PowerShell
# VirtualBox
$vboxmanage = "$env:ProgramFiles\Oracle\VirtualBox\VBoxManage.exe"
if (-not (Test-Path $vboxmanage)) {
    Write-Error "No se ha encontrado VBoxManage en $vboxmanage"
    return
}
```
- Azure
  - https://www.jesusninoc.com/06/28/instalacion-de-azure-powershell-en-windows-mediante-install-module/
  - https://www.jesusninoc.com/06/29/crea-un-nuevo-usuario-de-active-directory-en-azure/
  - https://www.jesusninoc.com/06/28/crear-una-maquina-virtual-con-un-windows-server-en-azure-desde-powershell/
  - https://www.jesusninoc.com/06/28/crear-una-maquina-virtual-en-azure-con-un-windows-server-y-un-internet-information-services-iis-desde-powershell/
  - https://www.jesusninoc.com/01/12/reconocer-emociones-de-las-caras-de-las-personas-que-hay-en-una-imagen-con-emotion-api-de-microsoft-azure/

```PowerShell
# Variables for common values
$resourceGroup = "myResourceGroup"
$location = "westeurope"
$vmName = "myVM"

# Create user object
$cred = Get-Credential -Message "Usuario y password para la máquina virtual"

# Simular creación del grupo de recursos (no lo crea)
New-AzResourceGroup -Name $resourceGroup -Location $location -WhatIf

# Simular creación de la máquina virtual y recursos asociados
New-AzVM `
  -ResourceGroupName $resourceGroup `
  -Name $vmName `
  -Location $location `
  -ImageName "Win2016Datacenter" `
  -VirtualNetworkName "myVnet" `
  -SubnetName "mySubnet" `
  -SecurityGroupName "myNetworkSecurityGroup" `
  -PublicIpAddressName "myPublicIp" `
  -Credential $cred `
  -OpenPorts 80 `
  -WhatIf
```
- Optimización de scripts
```Bash
nano monitor_servicios.sh
chmod 700 monitor_servicios.sh
sudo cat /var/log/monitor_servicios/monitor_servicios_$(date +%Y%m%d).log
# shellcheck
sudo apt-get update
sudo apt-get install -y shellcheck
shellcheck monitor_servicios.sh
```
```Bash
#!/bin/bash
# ---------------------------------------------------------
# Script : monitor_servicios.sh
# Propósito : Comprobar el estado de varios servicios,
#             generar un log y reiniciar los que fallen.
# Autor : (pon aquí tu nombre o "Alumno")
# Fecha : 2025-12-08
# ---------------------------------------------------------

# Ruta absoluta del directorio de logs
LOG_DIR="/var/log/monitor_servicios"
LOG_FILE="$LOG_DIR/monitor_servicios_$(/bin/date +%Y%m%d).log"

# Servicios a comprobar (cambiar por servicios reales del sistema)
SERVICIOS=("ssh" "cron" "apache2")

# Crear directorio de logs si no existe, con permisos restrictivos
if [ ! -d "$LOG_DIR" ]; then
  /bin/mkdir -p "$LOG_DIR"
  /bin/chmod 700 "$LOG_DIR"
fi

# Recorremos la lista de servicios
for servicio in "${SERVICIOS[@]}"; do
  FECHA=$(/bin/date "+%Y-%m-%d %H:%M:%S")
  ESTADO=$(/bin/systemctl is-active "$servicio" 2>/dev/null)

  if [ "$ESTADO" = "active" ]; then
    NIVEL="OK"
    MENSAJE="Servicio $servicio activo"
    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"
  elif [ -z "$ESTADO" ]; then
    NIVEL="UNKNOWN"
    MENSAJE="Servicio $servicio no existe o no está gestionado por systemd"
    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"
  else
    NIVEL="ERROR"
    MENSAJE="Servicio $servicio en estado '$ESTADO'. Intentando reinicio..."
    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"

    # Intentamos reiniciar el servicio
    /bin/systemctl restart "$servicio" 2>/dev/null
    NUEVO_ESTADO=$(/bin/systemctl is-active "$servicio" 2>/dev/null)
    FECHA=$(/bin/date "+%Y-%m-%d %H:%M:%S")

    if [ "$NUEVO_ESTADO" = "active" ]; then
      NIVEL="OK"
      MENSAJE="Servicio $servicio reiniciado correctamente"
    else
      NIVEL="CRITICAL"
      MENSAJE="No se pudo reiniciar el servicio $servicio (estado: '$NUEVO_ESTADO')"
    fi

    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"
  fi
done

exit 0
```

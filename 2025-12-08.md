# Scripting
- Curso acelerado de PowerShell https://www.jesusninoc.com/11/22/curso-online-de-powershell-diciembre-2025/
- Cron y tarea programada.
- Automatización
```PowerShell
# 1) Lista los 5 procesos que más CPU consumen
Get-Process |
    Sort-Object CPU -Descending |
    Select-Object -First 5 Id, ProcessName, CPU

# 2) Reinicia el servicio "Spooler" si está detenido
$servicio = Get-Service "Spooler"
if ($servicio.Status -eq "Stopped") {
    Start-Service "Spooler"
    $resultado = "El servicio Spooler estaba detenido y se ha iniciado."
} else {
    $resultado = "El servicio Spooler ya estaba iniciado."
}

# 3) Guarda la fecha y el resultado en un archivo de log
$fecha = Get-Date
$linea = "$fecha - $resultado"
$linea | Out-File -FilePath "C:\mantenimiento.log" -Append
```
```Bash
#!/bin/bash

service="apache2"
mail_to="admin@midominio.com"   # Cambia esto por tu correo

if ! systemctl is-active --quiet "$service"; then
    systemctl restart "$service"

    mensaje="$(date): Reinicio de $service en $(hostname)"

    echo "$mensaje" >> /var/log/mantenimiento.log

    echo "$mensaje" | mail -s "Reinicio automático de $service" "$mail_to"
fi

```
- Monitorizar VM
```PowerShell
# Hyper-V: detectar máquinas detenidas y mostrar una "alerta" simple
$stoppedVMs = Get-VM | Where-Object State -eq 'Off'

if ($stoppedVMs) {
    $stoppedVMs | ForEach-Object {
        Write-Warning "La VM de Hyper-V '$($_.Name)' está detenida."
    }

    # Aquí podrías añadir:
    # - Enviar un correo
    # - Escribir en el Visor de eventos
    # - Lanzar un popup, etc.
}
```
```PowerShell
# VirtualBox
$vboxmanage = "$env:ProgramFiles\Oracle\VirtualBox\VBoxManage.exe"
if (-not (Test-Path $vboxmanage)) {
    Write-Error "No se ha encontrado VBoxManage en $vboxmanage"
    return
}
```
- Configura AWS CLI y Azure CLI con cuentas de prueba (modo CLI offline).
```
aws ec2 run-instances --image-id ami-123456 --count 1 --instance-type t2.micro --dry-run
```
- Script profesional validado y seguro.

# Instalación, configuración y uso de servicios de acceso y administración remota
- Protocolos de acceso remoto y puertos implicados.
- Terminales en modo texto. Telnet, SSH,…
- Escritorio remoto.
- Servicios de acceso remoto del propio sistema operativo.
- Herramientas gráficas externas para la administración remota.
- Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones. Servicio de actualizaciones: WSUS, apt-cacher, etc. Configuración de los clientes para que usen los servidores de actualización. 

------------------

# Instalación, configuración y uso de servicios de acceso y administración remota
## Telnet
### Check e-mail on a pop3 server using telnet
* https://www.pantz.org/software/pop3/pop3telnet.html

----------------
----------------

# Instalación, configuración y uso de servicios de acceso y administración remota
- Protocolos de acceso remoto y puertos implicados.
- Terminales en modo texto. Telnet, SSH,…
- Escritorio remoto.
- Servicios de acceso remoto del propio sistema operativo.
- Herramientas gráficas externas para la administración remota.
- Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones. Servicio de actualizaciones: WSUS, apt-cacher, etc. Configuración de los clientes para que usen los servidores de actualización. 

------------------

# Instalación, configuración y uso de servicios de acceso y administración remota
## Protocolos y puertos
* https://www.jesusninoc.com/07/09/9-gestion-de-la-red-en-powershell/#Capa_de_transporte
* https://www.jesusninoc.com/07/09/9-gestion-de-la-red-en-powershell/#Capa_de_aplicacion
## Telnet
### Instalar y activar el servicio Telnet en Windows 10 (servidor y cliente)
* https://www.profesionalreview.com/wp-content/uploads/2018/12/configurar-servidor-telnet-paso-06.png
* https://rootear.com/files/2017/02/Telnet.jpg
### Check e-mail on a pop3 server using telnet
* https://www.pantz.org/software/pop3/pop3telnet.html
### Analizar conexión por Telnet desde Wireshark
* https://www.jesusninoc.com/network/
* https://www.jesusninoc.com/wireshark/
* https://www.jesusninoc.com/07/09/9-gestion-de-la-red-en-powershell/

----------------
----------------

# Cliente-Servidor
## Comunicación entre cliente y servidor
* https://www.jesusninoc.com/2015/02/25/creating-reverse-shell/
* https://www.jesusninoc.com/2015/02/26/creating-shell/
* https://www.jesusninoc.com/2017/10/18/crear-una-comunicacion-entre-un-cliente-en-bash-de-linux-y-un-servidor-en-powershell-de-windows-utilizando-tcpip/
* https://www.jesusninoc.com/2017/10/26/crear-una-comunicacion-entre-un-cliente-en-powershell-de-windows-y-un-servidor-en-bash-de-linux-utilizando-tcpip/
* https://www.jesusninoc.com/06/02/crear-una-comunicacion-entre-un-cliente-en-powershell-de-windows-y-un-servidor-en-node-js-utilizando-tcp-ip/
* https://www.jesusninoc.com/2016/04/30/simular-el-funcionamiento-de-un-servidor-web-utilizando-netcat-en-linux/
* https://www.jesusninoc.com/2009/06/06/ejecutar-nc-exe-cmd-exe-remotamente/
* https://www.jesusninoc.com/11/10/realizar-conexiones-tcp-udp-con-powershell/

---------------
---------------

# Instalación, configuración y uso de servicios de acceso y administración remota
- Protocolos de acceso remoto y puertos implicados.
- Terminales en modo texto. Telnet, SSH, ...
- Escritorio remoto.
- Servicios de acceso remoto del propio sistema operativo.
- Herramientas gráficas externas para la administración remota.
- Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones. Servicio de actualizaciones: WSUS, apt-cacher, etc. Configuración de los clientes para que usen los servidores de actualización. 

------------------

# Instalación, configuración y uso de servicios de acceso y administración remota

## SSH
* https://www.jesusninoc.com/ssh/
* https://www.jesusninoc.com/10/21/crear-y-ejecutar-un-script-de-bash-realizando-una-conexion-ssh-a-un-contenedor-docker-desde-powershell-en-windows/
* http://www.developandsys.es/conexion-remota-linux-ssh/
### - Ejercicio: configura conexiones SSH sin password en solo 3 pasos
Crear clave RSA para PC#1 cliente:
```Bash
ssh-keygen -b 4096 -t rsa
```
Lo que queremos es que PC#1 se conecte a PC#2, ya en PC#1 hicimos todo lo anterior, en PC#2 no hemos hecho nada. Bien, PC#2 tiene de dirección IP por ejemplo 10.10.0.5.
PC#1 se lo copia al server:
```Bash
ssh-copy-id root@10.10.0.5
```
Esto lo que hace es simplemente darle la llave pública de PC#1 a PC#2, o sea, le dá a PC#2 la llave pública de PC#1, mientras que PC#1 se queda con su llave privada, ya saben; esa llave que no se le dá a nadie.
Conexión al equipo sin password:
```Bash
ssh root@10.10.0.5
```

### - Ejemplos SSH
#### CONECTARSE POR SSH AL ROUTER DE FIBRA ÓPTICA MITRASTAR GPT-2541GNAC DE MOVISTAR DESDE POWERSHELL
* https://www.jesusninoc.com/11/16/conectarse-por-ssh-al-router-de-fibra-optica-mitrastar-de-movistar-desde-powershell/
#### VER LOS PROCESOS QUE SE ESTÁN EJECUTANDO EN EL ROUTER DE FIBRA ÓPTICA MITRASTAR GPT-2541GNAC DE MOVISTAR DESDE POWERSHELL
* https://www.jesusninoc.com/11/17/ver-los-procesos-que-se-estan-ejecutando-en-el-router-de-fibra-optica-mitrastar-de-movistar-desde-powershell/
### - Analizar conexión por SSH desde Wireshark
* https://www.jesusninoc.com/network/
* https://www.jesusninoc.com/wireshark/
* https://www.jesusninoc.com/07/09/9-gestion-de-la-red-en-powershell/
### - WinSCP
* https://www.jesusninoc.com/winscp/

------------------

# Router
## Conexión
### Configurando routers domésticos desde la línea de comandos con wget
* http://www.vicente-navarro.com/blog/2013/02/28/configurando-routers-domesticos-desde-la-linea-de-comandos-con-wget/
### AUTENTICARSE EN UN ROUTER DE FIBRA ÓPTICA MITRASTAR GPT-2541GNAC DE MOVISTAR Y VER UNA LISTA DE LLAMADAS PERDIDAS
* https://www.jesusninoc.com/04/10/autenticarse-en-un-router-de-fibra-optica-mitrastar-de-movistar-y-ver-una-lista-de-llamadas-perdidas/
### AUTENTICARSE EN UN ROUTER DE FIBRA ÓPTICA MITRASTAR GPT-2541GNAC DE MOVISTAR Y VER LAS ASIGNACIONES DHCP
* https://www.jesusninoc.com/05/14/autenticarse-en-un-router-de-fibra-optica-mitrastar-de-movistar-y-ver-las-asignaciones-dhcp/
## Ancho de banda
### Midiendo el ancho de banda de red con IPerf (y con scp, netcat, wget)
* http://www.vicente-navarro.com/blog/2008/12/13/midiendo-el-ancho-de-banda-de-red-con-iperf-y-con-scp-netcat-wget/

----------------
----------------

# Aplicación de lenguajes de «scripting» en sistemas operativos libres y propietarios
- Estructuras del lenguaje.
- Creación y depuración de «scripts».
- Interpretación de «scripts» del sistema. Adaptaciones.
- Utilización de extensiones de comandos para tareas de administración.
- «Scripts» para la gestión del directorio activo. Usuarios, grupos, acceso al registro, etc.
- «Scripts» para la administración de cuentas de usuario, procesos y servicios del sistema operativo. 

--------------------------

# Tratamiento de errores en PowerShell
## ErrorActionPreference

Las opciones disponibles son:
- SilentlyContinue: se suprimen los mensajes de error y la ejecución continúa
- Stop: se detiene la ejecución
- Continue: es la opción por defecto. Se muestra el error y la ejecución continúa
- Inquire: pregunta al usuario como proceder
- Ignore: el error es ignorado y no se registra ni muestra. 

```PowerShell
$ErrorActionPreference = "Stop"
Get-Childitem "C:\" -ErrorAction "Inquire"
```

## Try/Catch/Finally
```PowerShell
Try {
  # En esta sección ejecutamos los comandos cuyos errores queremos controlar
}
Catch [Excepcion] {
  # En esta sección gestionamos una exceción específica
}
Catch {
  # En esta sección gestionamos cualquier tipo de excepción
}
Finally {
  # Esta sección se ejecuta siempre, haya o no una excepción
}
```
### Ejemplo: capturar la excepción para saber si un recurso existe
```PowerShell
foreach($isbn in ((gc .\fotosprocesar.txt)))
{
try {
    $R = Invoke-WebRequest -URI ("https://www.example.com/wp-content/uploads/"+$imagen+".jpg")
    "existe"
    
}
catch {
    $isbn >> procesarurgente.txt
}
}
```

---------------
---------------

# Clase de hoy
* https://jesusninoc.github.io/ClasesASO/2019-11-22.html

------------------

# Aplicación de lenguajes de «scripting» en sistemas operativos libres y propietarios
- Estructuras del lenguaje.
- Creación y depuración de «scripts».
- Interpretación de «scripts» del sistema. Adaptaciones.
- Utilización de extensiones de comandos para tareas de administración.
- «Scripts» para la gestión del directorio activo. Usuarios, grupos, acceso al registro, etc.
- «Scripts» para la administración de cuentas de usuario, procesos y servicios del sistema operativo. 

--------------------------

# Tratamiento de errores en PowerShell
## ErrorActionPreference

Las opciones disponibles son:
- SilentlyContinue: se suprimen los mensajes de error y la ejecución continúa
- Stop: se detiene la ejecución
- Continue: es la opción por defecto. Se muestra el error y la ejecución continúa
- Inquire: pregunta al usuario como proceder
- Ignore: el error es ignorado y no se registra ni muestra. 

```PowerShell
$ErrorActionPreference = "Stop"
Get-Childitem "C:\" -ErrorAction "Inquire"
```

## Mostrar un mensaje de error personalizado

```PowerShell
Stop-Process –Name invalidprocess -ErrorAction SilentlyContinue -ErrorVariable ProcessError

If ($ProcessError) {
    ####### Something went wrong
    "No existe el proceso"
}
```

## Ejercicio: mostrar un error si alguna URL de descarga es incorrecta

```PowerShell
# Fichero URLS
## https://www.youtube.com/watch?v=6DeDzsCGbsQ
## https://www.youtube.com/watch?v=6DeDzsCGbsQ
## https://www.youtube.com/watch?v=6DeDzsCGbsQadsfdsfdasfdas
## https://www.youtu444be.com/watch?v=6DeDzsCGbsQ
## https://www.youtube.com/watch?v=6DeDzsCGbsQ

$ErrorActionPreference = "SilentlyContinue"

foreach($urls in gc urls.txt)
{
    $web = Invoke-WebRequest $urls -ErrorVariable ErrorWeb

    if ($ErrorWeb)
    {
        ####### Something went wrong
        "No existe la web"
    }
    else
    {
        "Sí existe la web"
    }
}
```

# Cómo depurar scripts en ISE de Windows PowerShell
* https://docs.microsoft.com/es-es/powershell/scripting/components/ise/how-to-debug-scripts-in-windows-powershell-ise?view=powershell-6

```PowerShell
1..10 | %{
    # Ver el valor de $suma con Alternar punto de interrupción
    $suma =+ $_
}
```

### Ejercicio: depurar el código que mostrar un error si alguna URL de descarga es incorrecta andes de que ocurra utilizando Set-PSBreakpoint

------------------

# Proyectos
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-simular-el-funcionamieto-del-dns-en-los-a%C3%B1os-70
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-analizar-informaci%C3%B3n-de-consultas-dns-realizar-distintas-peticiones-de-forma-detallada-de-tipo-a-ns-mx
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-analizar-y-establecer-un-orden-de-direcciones-ip-de-una-red-teniendo-en-cuenta-por-ejemplo-apipa-o-dhcp
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-analizar-informaci%C3%B3n-de-los-distintos-protocolos-de-la-red-dns-llmnr-dhcp-http-ftp-smtp-cups
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-crear-firmar-y-ejecutar-un-script-remotamente
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-descargar-de-web
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-crear-un-sistemas-de-gesti%C3%B3n-de-correo
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-ransomware
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-crear-un-fichero-xml-con-informaci%C3%B3n-sobre-el-sistema-de-archivos
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-monitorizar-el-sistema-mediante-un-fichero-xml
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-01-15.md#proyecto-crear-usuarios-mediante-un-fichero-xml

------------------

# Ejecutar remotamente desde PowerShell utilizando "Device Portal"

## Listar el contenido de un directorio remotamente desde PowerShell teniendo habilitado "Device Portal"
https://www.jesusninoc.com/2017/10/01/listar-el-contenido-de-un-directorio-remotamente-desde-powershell-teniendo-habilitado-device-portal/

## Arrancar una aplicación remotamente desde PowerShell teniendo habilitado "Device Portal"
https://www.jesusninoc.com/2017/09/27/arrancar-una-aplicacion-remotamente-desde-powershell-teniendo-habilitado-device-portal/

------------------

# Ejecutar un comando desde PowerShell mediante sockets UDP
* https://www.jesusninoc.com/12/29/server-and-client/

------------------

# Objetos en PowerShell
* https://www.jesusninoc.com/11/16/crear-un-array-arraylist-en-powershell-y-anadir-objetos/
* https://www.jesusninoc.com/07/02/2-programacion-en-powershell/#Objetos
* https://github.com/jesusninoc/ClasesISO/blob/master/2019-11-20.md#1-realizar-un-inventario-de-tu-equipo-a-nivel-hardware-y-software-ten-en-cuenta-c%C3%B3mo-clasificar-la-informaci%C3%B3n-y-no-olvides-temas-importantes-como-por-ejemplo-controladores

# LOAD XML SYNTAX (MYSQL)
* https://www.jesusninoc.com/11/17/load-xml-syntax-mysql/

# Ejercicio con objetos y XML: ¿Se puede mandar un objeto por la red?
## Almacenar un objeto junto con sus propiedades y métodos
```PowerShell
gps -name notepad | Export-Clixml -Path .\sample.xml
gps -name notepad | Out-File proce.txt

$notep = Import-Clixml .\sample.xml
$notep | Get-Member

$notep = Get-Content .\proce.txt
$notep | Get-Member
```

---------------
---------------

# Instalación, configuración y uso de servicios de acceso y administración remota
- Protocolos de acceso remoto y puertos implicados.
- Terminales en modo texto. Telnet, SSH, ...
- Escritorio remoto.
- Servicios de acceso remoto del propio sistema operativo.
- Herramientas gráficas externas para la administración remota.
- Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones. Servicio de actualizaciones: WSUS, apt-cacher, etc. Configuración de los clientes para que usen los servidores de actualización. 

------------------

# Objetos en PowerShell
* https://www.jesusninoc.com/11/16/crear-un-array-arraylist-en-powershell-y-anadir-objetos/
* https://www.jesusninoc.com/07/02/2-programacion-en-powershell/#Objetos
* https://github.com/jesusninoc/ClasesISO/blob/master/2018-11-21.md#1-realizar-un-inventario-de-tu-equipo-a-nivel-hardware-y-software-ten-en-cuenta-c%C3%B3mo-clasificar-la-informaci%C3%B3n-y-no-olvides-temas-importantes-como-por-ejemplo-controladores

# Ejercicio con objetos y XML: ¿Se puede mandar un objeto por la red?
## Almacenar un objeto junto con sus propiedades y métodos
```PowerShell
gps -name notepad | Export-Clixml -Path .\sample.xml
gps -name notepad | Out-File proce.txt

$notep = Import-Clixml .\sample.xml
$notep | Get-Member

$notep = Get-Content .\proce.txt
$notep | Get-Member
```

------------------

# SSH repaso
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-11-19.md

------------------

# Ejercicio: conectarse por SSH a MikroTik
## Ayuda
### Manual:First time startup
* https://wiki.mikrotik.com/wiki/Manual:First_time_startup
### Manual:Configuration Management
* https://wiki.mikrotik.com/wiki/Manual:Configuration_Management
### Manual:IP/SSH
* https://wiki.mikrotik.com/wiki/Manual:IP/SSH

----------------
----------------

# Examen

## Tener en cuenta
- Directorio Activo
- Monitorización (procesos, hilos, servicios)
- Sistema de archivos (integridad, logs, copias de segurida, permisos)
- Conexiones remotas
- Scripting (errores, objetos)

## Situaciones
- Leer un fichero por SSH y realizar operaciones en un Windows Server y Ubuntu Server, algunos ejemplos de operaciones son:
    - Crear usuarios
    - Comprobar que un fichero es integro
    - Monitorizar procesos y servicios

- Leer de una base de datos el nombre y password, realizar operaciones en un Windows Server y Ubuntu Server, algunos ejemplos de operaciones son:
    - Crear usuarios
    - Monitorizar procesos y servicios

## Soluciones al examen
* https://github.com/Kinon4/powershell/blob/master/Men%C3%BA%20con%20funciones%20en%20Powershell%20ASO.md
* https://github.com/GonzaloMB/ASIR2/blob/master/EXAMEN%20ASO
* https://github.com/manuanton/Ejercicios/blob/master/A%C3%B1adir%20usuarios%20al%20AD%2C%20informacion%20sobre%20procesos%20y%20servicios%20y%20comprobar%20integridad%20de%20un%20fichero%20por%20SSH
* https://github.com/MikeRuSe/Scripts/blob/master/11_29_2019-Examen-ASO.ps1

## Ayuda
- DESCARGAR UN FICHERO POR SSH DE UN SERVIDOR LINUX DESDE POWERSHELL EN WINDOWS
    * https://www.jesusninoc.com/11/04/descargar-un-fichero-por-ssh-de-un-servidor-linux-desde-powershell-en-windows/
- SUBIR UN FICHERO POR SSH A UN SERVIDOR LINUX DESDE POWERSHELL EN WINDOWS
    * https://www.jesusninoc.com/11/02/subir-un-fichero-por-ssh-a-un-servidor-linux-desde-powershell-en-windows/
- Códigos variados
```PowerShell
Get-SCPFile -LocalFile operar.csv -RemoteFile operar -ComputerName 192.168.1.162 -Credential (Get-Credential)
Get-SCPFile -LocalFile integridad.txt -RemoteFile integridad -ComputerName 192.168.1.162 -Credential (Get-Credential)

$ficherointegridad = gc integridad.txt
$ficherointegridad.split(" ")[0]

#notepad operar.csv
#nombre,operacion
#juan,0
#pedro,kldjasfkldasfkldlasfjdasjfladsjfds,1
#(ps).threads > cihero,2

notepad .\operar.csv
$var1 = Get-FileHash "C:\Users\ajnino\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs\root\operar.csv" -Algorithm SHA1
$var2 = Get-FileHash .\operar.csv -Algorithm SHA1

if ($var1.Hash -eq $var2.Hash)
{
    "es igual"
}
else
{
    "no es igual"
}

foreach($operacion in Import-Csv .\operar.csv)
{
    switch($operacion.operacion)
    {
        0{New-ADUser -Name $operacion.nombre -Sam  $operacion.nombre -Path "OU=UnidadPrueba,DC=andel,DC=local" -AccountPassword (ConvertTo-SecureString "Contrasena_1928" -AsPlainText -force) -Enable $true}
        1{$operacion.nombre}
        2{$operacion.nombre | iex}
    }
}
```

-----------------
-----------------

# Instalación, configuración y uso de servicios de acceso y administración remota
- Protocolos de acceso remoto y puertos implicados.
- Terminales en modo texto. Telnet, SSH, ...
- Escritorio remoto.
- Servicios de acceso remoto del propio sistema operativo.
- Herramientas gráficas externas para la administración remota.
- Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones. Servicio de actualizaciones: WSUS, apt-cacher, etc. Configuración de los clientes para que usen los servidores de actualización. 

------------------

# Repaso
- How to Update a Fork in Github
  * https://rick.cogley.info/post/update-your-forked-repository-directly-on-github/
- Examen
  * https://github.com/jesusninoc/ClasesASO/blob/master/2019-11-29.md
- SSH
  * https://github.com/jesusninoc/ClasesASO/blob/master/2019-11-19.md

------------------

# Ejemplo: conectarse a un Routerboard de MicroTik, establecer una dirección IP en el dispositivo y crear un script que muestre cinco números
## Ayuda
### Manual:First time startup
* https://wiki.mikrotik.com/wiki/Manual:First_time_startup
### Manual:IP/Address
* https://wiki.mikrotik.com/wiki/Manual:IP/Address
### Do not use console numbers to get parameter values
* https://wiki.mikrotik.com/wiki/Manual:Scripting_Tips_and_Tricks#Do_not_use_console_numbers_to_get_parameter_values
### Script repository
* https://wiki.mikrotik.com/wiki/Manual:Scripting#Script_repository
### Create a file
* https://wiki.mikrotik.com/wiki/Manual:Scripting-examples#Create_a_file
## Script
```MicroTik
:for i from= 1 to= 2 do={ :put $i }	
```

---------------
---------------

# Instalación, configuración y uso de servicios de acceso y administración remota
- Protocolos de acceso remoto y puertos implicados.
- Terminales en modo texto. Telnet, SSH, ...
- Escritorio remoto.
- Servicios de acceso remoto del propio sistema operativo.
- Herramientas gráficas externas para la administración remota.
- Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones. Servicio de actualizaciones: WSUS, apt-cacher, etc. Configuración de los clientes para que usen los servidores de actualización. 

------------------

# Ejemplo: conectarse a un Routerboard de MicroTik, crear y ejecutar un script
## Ayuda
### Manual:First time startup
* https://wiki.mikrotik.com/wiki/Manual:First_time_startup
### Manual:IP/Address
* https://wiki.mikrotik.com/wiki/Manual:IP/Address
### Do not use console numbers to get parameter values
* https://wiki.mikrotik.com/wiki/Manual:Scripting_Tips_and_Tricks#Do_not_use_console_numbers_to_get_parameter_values
### Script repository
* https://wiki.mikrotik.com/wiki/Manual:Scripting#Script_repository
### Create a file
* https://wiki.mikrotik.com/wiki/Manual:Scripting-examples#Create_a_file
## Script
```MicroTik
[admin@MikroTik] /system script>> add name="test6" source=":for  i  from=0  to=150 step=10  do={  :beep  frequency=(1295  -  i)  length=22ms;   :delay  22ms;   :beep  frequency=(1095  +  i)  length=22ms;   :delay  22ms;   }" 
[admin@MikroTik] /system script>> run number= test6     
```

------------------

# Ejemplo: conectarse a un Routerboard de MicroTik, establecer una dirección IP en el dispositivo y crear un script que muestre cinco números
## Ayuda
### Manual:First time startup
* https://wiki.mikrotik.com/wiki/Manual:First_time_startup
### Manual:IP/Address
* https://wiki.mikrotik.com/wiki/Manual:IP/Address
### Do not use console numbers to get parameter values
* https://wiki.mikrotik.com/wiki/Manual:Scripting_Tips_and_Tricks#Do_not_use_console_numbers_to_get_parameter_values
### Script repository
* https://wiki.mikrotik.com/wiki/Manual:Scripting#Script_repository
### Create a file
* https://wiki.mikrotik.com/wiki/Manual:Scripting-examples#Create_a_file
## Script
### Sonido
```MicroTik
[admin@MikroTik] /system script>> add name="test6" source=":for  i  from=0  to=150
  step=10  do={  :beep  frequency=(1295  -  i)  length=22ms;   :delay  22ms;   :be
ep  frequency=(1095  +  i)  length=22ms;   :delay  22ms;   }" 
[admin@MikroTik] /system script>> run number= test6 
```
### Sin sonido, solo bucle
```MicroTik
:for i from= 1 to= 2 do={ :put $i }	
```

------------------

# Ejercicio: conectarse por SSH a MikroTik y ejecutar un script que ejecute cinco veces un beep cada segundo
## Ayuda
### Manual:First time startup
* https://wiki.mikrotik.com/wiki/Manual:First_time_startup
### Manual:Configuration Management
* https://wiki.mikrotik.com/wiki/Manual:Configuration_Management
### Manual:IP/SSH
* https://wiki.mikrotik.com/wiki/Manual:IP/SSH
### Manual:Scripting
* https://wiki.mikrotik.com/wiki/Manual:Scripting

------------------

# Ejercicio: conectarse por SSH a MikroTik y desde MikroTik conectarse por SSH a un Linux
## Ayuda
### Manual:First time startup
* https://wiki.mikrotik.com/wiki/Manual:First_time_startup
### Manual:Configuration Management
* https://wiki.mikrotik.com/wiki/Manual:Configuration_Management
### Manual:System/SSH client
* https://wiki.mikrotik.com/wiki/Manual:System/SSH_client

------------------

# Ejercicio avanzado: permitir y bloquear la conexión SSH en el Firewall de Mikrotik
## Ayuda

### Firewall con ejemplos

**Connection tracking**: permite visualizar las conexiones en las que interviene
nuestro equipo.

```
[admin@MikroTik] > ip firewall connection print
Flags: S - seen reply, A - assured

 #    PROTOCOL  SRC-ADDRESS           DST-ADDRESS       TCP-STATE     TIMEOUT
0 SA  tcp       192.168.88.4:34838    192.168.88.1:23   established   21h54m32s
1 SA  tcp       192.168.4.254:48101   192.168.4.1:8291  established   23h59m59s
2     udp       192.168.4.1:123       163.10.0.84:123                 8s
3 SA  tcp       192.168.4.254:51654   192.168.4.1:23    established   4m59s
```

### Reglas generales

**Escritura de firewall**: siempre conviene empezar con las reglas de estado,
para ahorrar procesamiento y acelerar las conexiones ya establecidas y las
relativas.

```
[admin@MikroTik] > ip firewall filter add connection-state=established action=accept chain=input
[admin@MikroTik] > ip firewall filter add connection-state=related action=accept chain=input
[admin@MikroTik] > ip firewall filter add connection-state=invalid action=drop  chain=input
[admin@MikroTik] > ip firewall filter add protocol=tcp src-port=8291 in-interface=!wlan1 action=accept chain=input comment="DENIEGA WINBOX DESDE LA WIRELESS"
```

**Aceptar conexiones VPN**:

```
[admin@MikroTik] > ip firewall filter add protocol=gre action=accept chain=input
[admin@MikroTik] > ip firewall filter add protocol=tcp dst-port=1723 action=accept chain=input comment="ACEPTO CONEXIONES VPN"
```

**Denegar ping y loguear los intentos de ping**:

```
[admin@MikroTik] > ip firewall filter add protocol=icmp chain=input action=log log-prefix="PING DENEGADO"
[admin@MikroTik] > ip firewall filter add protocol=icmp action=accept chain=input comment="DENIEGO ICMP"
[admin@MikroTik] > log print
23:34:12 firewall,info PING DENEGADO input: in:ether1 out:(none), src-mac 00:21:70:fd:e3:25, proto ICMP (type 8, code 0), 192.168.4.254->192.168.4.1, len 64
```

### Uso de listas

Las listas contienen direcciones IP para las que podemos tomar determinadas
acciones. De esta manera, mantenemos una única lista de direcciones y la
invocamos en el firewall.

**Crear una lista especificando desde dónde permitimos conexiones SSH**

```
[admin@MikroTik] > ip firewall address-list add list=ssh-permitido address=192.168.1.2/32 comment="MAQUINA DEL ADMINISTRADOR"
[admin@MikroTik] > ip firewall filter add src-address-list=!ssh-permitido protocol=tcp dst-port=22 action=drop chain=input comment="ACEPTO SSH DESDE LAS MAQUINAS EN LA LISTA ssh-permitido"
```

--------------
--------------

# Instalación, configuración y uso de servicios de acceso y administración remota
- Protocolos de acceso remoto y puertos implicados.
- Terminales en modo texto. Telnet, SSH, ...
- Escritorio remoto.
- Servicios de acceso remoto del propio sistema operativo.
- Herramientas gráficas externas para la administración remota.
- Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones. Servicio de actualizaciones: WSUS, apt-cacher, etc. Configuración de los clientes para que usen los servidores de actualización. 

------------------

# Instalación, configuración y uso de servicios de acceso y administración remota

## SSH

### - WinSCP
* https://www.jesusninoc.com/winscp/

### - TÚNEL

#### CONFIGURAR FIREFOX PARA UTILIZAR UN TÚNEL SSH COMO UN PROXY SOCKS
* https://www.jesusninoc.com/02/09/configurar-firefox-para-utilizar-un-tunel-ssh-como-un-proxy-socks/

#### Socks
* http://www.vicente-navarro.com/blog/2009/06/13/reenvio-dinamico-de-puertos-montar-un-servidor-socks-con-ssh/

#### CONFIGURAR UN TÚNEL UTILIZANDO UN SERVIDOR SSH
* https://www.jesusninoc.com/02/08/configurar-un-tunel-utilizando-un-servidor-ssh/

#### REALIZAR CONEXIÓN CON WINSCP UTILIZANDO UN TÚNEL SSH
* https://www.jesusninoc.com/02/12/realizar-conexion-con-winscp-utilizando-un-tunel-ssh/

### - Rsync
* http://www.vicente-navarro.com/blog/2009/05/16/rsync-siempre-sincroniza-ciertos-ficheros-ver-los-segundos-de-la-fecha-de-un-fichero/

#### Configurar una conexión a carpetas compartidas en Linux utilizando rsync

##### File: /etc/network/interfaces
```Bash
auto lo
iface lo inet loopback
auto eth0
iface eth0 inet static
        address 208.88.34.106
        netmask 255.255.255.248
        broadcast 208.88.34.111
        network 208.88.34.104
        gateway 208.88.34.110
```

##### Montar un sistema SMB
```Bash
sudo apt-get install cifs-utils
sudo mount.cifs //10.0.1.101/copias /mnt/backup -o user=user,pass=pass
```

##### Sincronizar carpetas montadas
```Bash
rsync -rutv --progress --bwlimit=40000 /srv/carpeta/ /mnt/backup/carpeta/
rsync -rutvl --progress --bwlimit=40000 /var/www/web/ /mnt/backup/www
```

##### Access the Windows Share from Linux
https://www.howtogeek.com/176471/how-to-share-files-between-windows-and-linux/

```Bash
sudo apt-get install cifs-utils
mkdir ~/Desktop/Windows-Share 
sudo mount.cifs //WindowsPC/Share /home/jes/Desktop/Windows-Share -o user=jesusninoc
````

##### Create a Share on Linux and Access It from Windows
```Bash
sudo apt-get install samba
smbpasswd -a jesusninoc
mkdir ~/Desktop/Share
sudo vi /etc/samba/smb.conf
[<folder_name>]
path = /home/<user_name>/<folder_name> 
available = yes 
valid users = <user_name> 
read only = no 
browsable = yes 
public = yes 
writable = yes
sudo service smbd restart
```

### - SSH PORT FORWARDING EXAMPLE
* http://www.vicente-navarro.com/blog/2009/05/24/creando-tuneles-tcpip-port-forwarding-con-ssh-los-8-escenarios-posibles-usando-openssh/
* https://www.ssh.com/ssh/tunneling/example
* https://wiki.mikrotik.com/wiki/Manual:IP/SSH

------------------

# Ejemplo
## CREAR UNA CONEXIÓN SSH, SUBIR UN FICHERO Y EJECUTAR UN SCRIPT QUE UTILICE EL FICHERO SUBIDO, REALIZAR LA CONEXIÓN DESDE POWERSHELL
  * https://www.jesusninoc.com/12/09/crear-una-conexion-ssh-subir-un-fichero-y-ejecutar-un-script-que-utilice-el-fichero-subido-realizar-la-conexion-desde-powershell/

-------------
-------------

# Instalación, configuración y uso de servicios de acceso y administración remota
- Protocolos de acceso remoto y puertos implicados.
- Terminales en modo texto. Telnet, SSH, ...
- Escritorio remoto.
- Servicios de acceso remoto del propio sistema operativo.
- Herramientas gráficas externas para la administración remota.
- Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones. Servicio de actualizaciones: WSUS, apt-cacher, etc. Configuración de los clientes para que usen los servidores de actualización. 

------------------

# Instalación, configuración y uso de servicios de acceso y administración remota

## SSH

### - Rsync
* http://www.vicente-navarro.com/blog/2009/05/16/rsync-siempre-sincroniza-ciertos-ficheros-ver-los-segundos-de-la-fecha-de-un-fichero/

#### Configurar una conexión a carpetas compartidas en Linux utilizando rsync

##### File: /etc/network/interfaces
```Bash
auto lo
iface lo inet loopback
auto eth0
iface eth0 inet static
        address 208.88.34.106
        netmask 255.255.255.248
        broadcast 208.88.34.111
        network 208.88.34.104
        gateway 208.88.34.110
```

##### Montar un sistema SMB
```Bash
sudo apt-get install cifs-utils
mkdir /mnt/backup
sudo mount.cifs //10.0.1.101/copias /mnt/backup -o user=user,pass=pass
```

##### Sincronizar carpetas montadas
```Bash
rsync -rutv --progress --bwlimit=40000 /srv/carpeta/ /mnt/backup/carpeta/
rsync -rutvl --progress --bwlimit=40000 /var/www/web/ /mnt/backup/www
```

##### Create a Share on Linux and Access It from Windows
```Bash
sudo apt-get install samba
smbpasswd -a jesusninoc
mkdir ~/Desktop/Share
sudo nano /etc/samba/smb.conf

[<folder_name>]
path = /home/<user_name>/<folder_name> 
available = yes 
valid users = <user_name> 
read only = no 
browsable = yes 
public = yes 
writable = yes

sudo service smbd restart
```

### - SSH PORT FORWARDING EXAMPLE
* http://www.vicente-navarro.com/blog/2009/05/24/creando-tuneles-tcpip-port-forwarding-con-ssh-los-8-escenarios-posibles-usando-openssh/
* https://www.ssh.com/ssh/tunneling/example
* https://wiki.mikrotik.com/wiki/Manual:IP/SSH

------------------

# Ejercicio
## Subir ficheros a una carpeta y sincronizar con otras carpetas
## Subir ficheros HTML a una carpeta
## Crear un sistema de escritorio remoto
  * https://www.jesusninoc.com/02/01/automatizar-tareas/
  * https://www.jesusninoc.com/03/01/mover-el-raton-a-las-posiciones-que-estan-guardadas-en-un-fichero/
  * https://www.jesusninoc.com/11/19/hacer-clic-en-una-posicion-de-la-pantalla-con-powershell/
  * https://www.jesusninoc.com/02/02/realizar-captura-de-pantalla-y-dividir-en-partes-la-captura/
  * https://www.jesusninoc.com/07/06/send-the-cursors-position-between-client-and-server-sockets-udp/
  * https://www.jesusninoc.com/07/10/transfer-image-between-server-and-client-sockets-tcp/
  * https://www.jesusninoc.com/11/07/transfer-images-between-server-and-client-sockets-tcp/

------------------

# Instalación, configuración y uso de servicios de acceso y administración remota

## Acceso remoto desde Powershell
```PowerShell
Invoke-Command -Credential administrador -ComputerName 192.168.1.56 -ScriptBlock{hostname} 
```
### Quick Default Configuration
* https://docs.microsoft.com/en-us/windows/desktop/winrm/installation-and-configuration-for-windows-remote-management#quick-default-configuration

### How to Add a Computer to the TrustedHosts List
* http://winintro.ru/windowspowershell2corehelp.en/html/f23b65e2-c608-485d-95f5-a8c20e00f1fc.htm

## Windows Remote Management and WMI

### Joining WMI Classes in a query
* https://lazywinadmin.com/2019/06/wmi_inner_join.html

------------------

# Ejemplo
## Ordenar direcciones IP remotamente y crear un disco virtual (Invoke-Command)

```PowerShell
# Necesita winrm, el módulo TCPServer e Hyper-V habilitado

$menu=@"
1 Ordenar IPs
2 Crear VHD
S Salir
 
Seleccione una tarea o pulse S para salir
"@

$equipos = Get-ADComputer -Filter * | select -ExpandProperty name

Function Invoke-Menu {
[cmdletbinding()]
Param(
[Parameter(Position=0,Mandatory=$True,HelpMessage="Enter your menu text")]
[ValidateNotNullOrEmpty()]
[string]$Menu,
[Parameter(Position=1)]
[ValidateNotNullOrEmpty()]
[string]$Title = "My Menu",
[Alias("cls")]
[switch]$ClearScreen
)
 
#clear the screen if requested
if ($ClearScreen) { 
 Clear-Host 
}
 
#build the menu prompt
$menuPrompt = $title
#add a return
$menuprompt+="`n"
#add an underline
$menuprompt+="-"*$title.Length
#add another return
$menuprompt+="`n"
#add the menu
$menuPrompt+=$menu
 
Read-Host -Prompt $menuprompt
 
}

Do {
    Switch (Invoke-Menu -menu $menu -title "Tareas de administración" -clear) {
     "1" {$i = 20
           $equipos | where {$_ -notmatch "SERVER"} | %{
            $ipn = "192.168.1." + $i++
            Write-Host "Cambiando IP de $_" -ForegroundColor Green
             sleep -seconds 2
                Enter-PSSession -ComputerName $_
                Invoke-Command -ComputerName $_ -ScriptBlock {
                    $ipa = Get-NetIPAddress -InterfaceIndex 7 -AddressFamily IPv4 | select -ExpandProperty IPAddress
                    New-NetIPAddress -IPAddress $using:ipn -AddressFamily IPv4 -InterfaceIndex 7 -PrefixLength 24
                    Remove-NetIPAddress -IPAddress "$ipa" -Confirm:$False
                } -AsJob
                Exit-PSSession
                }
             Clear-DnsClientCache
             Read-Host "IPs cambiadas con éxito, presione ENTER para volver al menú"
         } 
     "2" {Write-Host "Por favor, especifique los parámetros deseados" -ForegroundColor Green
          sleep -seconds 2

            $cliente = Read-Host "Introduzca el equipo donde quiere crear el VHD"
            $nombre = Read-Host "Introduzca el nombre del disco"
            $archivo = "C:\" + $nombre + ".vhdx"
            $letra = 65..90 | %{[char]$_} | Where-Object {$_ -notin (Get-Partition | select -ExpandProperty DriveLetter)} | Get-Random
            $capacidad = Read-Host "Introduzca la capacidad en MB"
            $secpasswd = ConvertTo-SecureString "Escarabajo.11" -AsPlainText -Force
            $mycreds = New-Object System.Management.Automation.PSCredential ("red\administrador", $secpasswd)

            Invoke-TCPServer -Computername $cliente -Port 1655 `
            -Credential ($mycreds) -Verbose

            $command = @"
            New-VHD -Path $archivo -SizeBytes ([int]$capacidad* 1MB)
            Mount-VHD $archivo -Passthru | Initialize-Disk -PassThru | 
            New-Partition -UseMaximumSize -DriveLetter "$letra"   | 
            Format-Volume -FileSystem NTFS -NewFileSystemLabel $nombre -Confirm:0
"@
            Send-Command -Computername $cliente -Port 1655 -Command "$command" `
            -Verbose -Credential ($mycreds)
        Read-Host "VHD creado con éxito, presione ENTER para volver al menú"

          }
     "S" {Write-Host "Adiós!" -ForegroundColor Magenta
         Return
         }
     Default {Write-Warning "Por favor, introduzca una opción válida"
              sleep -milliseconds 2400}
    }
} While ($True)
```

---------------
---------------

# Examen liberatorio

## Caso del administrador remoto (o no)
- Realizar tareas en equipos remotos (Windows y Linux) utilizando el protocolo TCP o UDP

### Ayuda
#### EJECUTAR UN CMDLET REMOTAMENTE EN UN EQUIPO UTILIZANDO SOCKETS UDP
* https://www.jesusninoc.com/01/27/ejecutar-un-cmdlet-remotamente-en-un-equipo-utilizando-sockets-udp/
#### CREAR UNA COMUNICACIÓN ENTRE UN CLIENTE EN BASH DE LINUX Y UN SERVIDOR EN POWERSHELL DE WINDOWS UTILIZANDO TCP/IP
* https://www.jesusninoc.com/10/18/crear-una-comunicacion-entre-un-cliente-en-bash-de-linux-y-un-servidor-en-powershell-de-windows-utilizando-tcpip/

----------------
----------------

# Examen de evaluación

## Preguntas posibles para el examen de evaluación

- Enviar mail a compañeros por hosts
- Crear usuarios leyendo de un fichero XML
- Validar usuarios en el Directorio Activo
- Buscar usuarios mediante filtros LDAP
- Convertir a PDF información sobre el sistema operativo
- Copia de seguridad de usuarios
- Crear un servicio para arrancar Apache
- Analiar información de hilos

## Exámenes para repasar
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-11-29.md
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-12-13.md

## Temario que entra en el examen de evaluación

### Administración de servicio de directorio
- Servicio de directorio. Definición, elementos y nomenclatura. LDAP.
- Esquema del servicio de directorio.
- Funciones del dominio
- Controladores de dominio.
- Instalación, configuración y personalización del servicio de directorio.
- Creación de dominios.
- Objetos que administra un dominio: usuarios globales, grupos y equipos entre otros.
- Herramientas gráficas de administración del servicio de directorio.
- Filtros de búsqueda.
- Integración del servicio de directorio con otros servicios.
- Relaciones de confianza. 

### Administración de procesos del sistema
- Procesos. Tipos. Estados. Estructura.
- Hilos de ejecución.
- Transiciones de estados.
- Prioridades.
- Identificación de los procesos del sistema.
- Gestión de los procesos del sistema. Línea de orden. Entorno gráfico.
- Secuencia de arranque del sistema. Demonios.
- Niveles de ejecución del sistema. Cambio.
- Interrupciones. Excepciones.

### Información del sistema
- Estructura de directorios.
- Búsqueda de información del sistema. Órdenes. Herramientas gráficas.
- Sistema de archivos virtual.
- Software instalado. Órdenes. Herramientas gráficas.
- Gestión de la información del sistema. Rendimiento. Estadísticas.

### Instalación, configuración y uso de servicios de acceso y administración remota
- Protocolos de acceso remoto y puertos implicados.
- Terminales en modo texto. Telnet, SSH,…
- Escritorio remoto.
- Servicios de acceso remoto del propio sistema operativo.
- Herramientas gráficas externas para la administración remota.
- Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones. Servicio de actualizaciones: WSUS, apt-cacher, etc. Configuración de los clientes para que usen los servidores de actualización. 


### Integración de sistemas operativos en red libres y propietarios
- Descripción de escenarios heterogéneos.
- Instalación, configuración y uso de servicios de red para compartir recursos.
- Sistemas de archivos compartidos en red
- Configuración de recursos compartidos en red.
- Protocolos para redes heterogéneas.
- Utilización de redes heterogéneas.
- Sistemas de archivos distribuidos. Replicación. 

### Aplicación de lenguajes de «scripting» en sistemas operativos libres y propietarios:
- Estructuras del lenguaje.
- Creación y depuración de «scripts».
- Interpretación de «scripts» del sistema. Adaptaciones.
- Utilización de extensiones de comandos para tareas de administración.
- «Scripts» para la gestión del directorio activo. Usuarios, grupos, acceso al registro, etc.
- «Scripts» para la administración de cuentas de usuario, procesos y servicios del sistema operativo. 

------------
------------

# Instalación, configuración y uso de servicios de acceso y administración remota
- Protocolos de acceso remoto y puertos implicados.
- Terminales en modo texto. Telnet, SSH, ...
- Escritorio remoto.
- Servicios de acceso remoto del propio sistema operativo.
- Herramientas gráficas externas para la administración remota.
- Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones. Servicio de actualizaciones: WSUS, apt-cacher, etc. Configuración de los clientes para que usen los servidores de actualización. 

# Gestión centralizada de las actualizaciones del sistema operativo y las aplicaciones

## apt-cacher
* https://diocesanos.es/blogs/equipotic/2016/11/11/instalacion-y-actualizacion-de-apt-cacher/

## WSUS
### WSUS configurado mediante GPO
* https://hackpuntes.com/wsus-windows-server-update-services-configuracion-de-politica-parte-ii/

--------------------------

# Aplicación de lenguajes de «scripting» en sistemas operativos libres y propietarios
- Estructuras del lenguaje.
- Creación y depuración de «scripts».
- Interpretación de «scripts» del sistema. Adaptaciones.
- Utilización de extensiones de comandos para tareas de administración.
- «Scripts» para la gestión del directorio activo. Usuarios, grupos, acceso al registro, etc.
- «Scripts» para la administración de cuentas de usuario, procesos y servicios del sistema operativo. 

## Funciones
* https://www.youtube.com/watch?v=hBm1U8ft6NA
* https://github.com/jesnino/PowerShell/tree/master/Funciones
* https://github.com/jesnino/PowerShell/blob/master/Funciones/EjemplosFuncionesAvanzadasLogin.ps1
* https://github.com/jesnino/PowerShell/blob/master/Funciones/EjerciciosFuncionesAvanzadasLogin.ps1
* https://github.com/jesnino/PowerShell/blob/master/Funciones/EjerciciosFuncionesAvanzadasLoginHash.ps1
* https://github.com/jesnino/PowerShell/blob/master/Funciones/EjerciciosFuncionesLogin.ps1

## PowerShell Workflows: The Basics
* https://blogs.technet.microsoft.com/heyscriptingguy/2012/12/26/powershell-workflows-the-basics/

### Ejercicio: ver información sobre equipo mediante la utilización de Flujos de trabajo (Workflows) en PowerShell

```PowerShell
workflow foreachpstest {
   param([string[]]$computers)
   foreach –parallel ($computer in $computers){
    sequence {
      Get-WmiObject -Class Win32_ComputerSystem -PSComputerName $computer
      Get-WmiObject –Class Win32_OperatingSystem –PSComputerName $computer
    }
   }
}

foreachpstest equipo1, equipo2
```

## LEER DATOS DE ARCHIVOS .PSD1 EN POWERSHELL 5
* https://www.jesusninoc.com/12/17/leer-datos-de-archivos-psd1-en-powershell-5/

--------------------------

# Administración de servidores de aplicaciones
- Concepto y técnicas. Granjas de servidores. Productos.
- Instalación y configuración de los servicios de escritorio.
- Administrar las licencias. Tipos y características.
- Administración de los servicios de escritorio remoto. Administración de usuarios, sesiones y procesos. Ver los usuarios conectados, las sesiones en ejecución y los procesos en ejecución. Conexión, desconexión, restablecimiento y cierre de una sesión de usuario. Comunicación con el usuario mediante mensajes. Uso de herramientas de línea de comandos.
- Administración de servidores. Grupos de servidores.
- Administrador de la puerta de enlace de escritorio remoto. Configurar el servidor y el cliente. Uso de la directiva de grupo para administrar las conexiones del cliente a través de la puerta de enlace. Informes y estado de la conexión.
- Publicación de aplicaciones remotas. Asignar usuarios y grupos de dominio a una aplicación.
- Creación de un archivo de conexión. Creación del paquete y distribución a los usuarios.
  
## Concepto y técnicas. Granjas de servidores. Productos.
## Instalación y configuración de los servicios de escritorio.
  - https://blog.ragasys.es/remote-desktop-services-instalacion-de-los-servicios-de-escritorio-remoto

## Scripts en PowerShell
### How to Install Windows Active Directory from PowerShell Command Line 
```
Import-Module ADDSDeployment
Install-ADDSForest `
-CreateDnsDelegation:$false `
-DatabasePath "C:\Windows\NTDS" `
-DomainMode "Win2012R2" `
-DomainName "prueba.local" `
-DomainNetbiosName "PRUEBA" `
-ForestMode "Win2012R2" `
-InstallDns:$true `
-LogPath "C:\Windows\NTDS" `
-NoRebootOnCompletion:$false `
-SysvolPath "C:\Windows\SYSVOL" `
-Force:$true

```

- Directorio Activo
  - Añadir servidor a Controlador de Dominio (ejecutar en servidor C:\Windows\System32\Sysprep\sysprep.exe)
  - Aplicación de GPO (gpupdate /force)
```PowerShell
- Crear un usuario en el AD, delegar la tarea de "Unir un equipo al dominio" a ese usuario y ejecutar el script para que el equipo se meta en el dominio (desde el equipo que queremos meter en el dominio)
  - Local
  - Remoto
    * http://community.idera.com/powershell/powertips/b/tips/posts/joining-computers-to-a-domain
- Analizar GPO (en remoto y local)
  - Local
    * https://www.jesusninoc.com/05/12/view-group-policy-objects/
    ```PowerShell
      $resulta = gpresult /z
      foreach($lineas in $resulta)
      {
          if($lineas -match "CMD")
          {
              $lineas
          }
      } 
    ```
  - Remoto
    * https://www.jesusninoc.com/04/23/obtener-gpos-objetos-de-directiva-de-grupo-que-no-se-estan-utilizando/
    ```PowerShell
    Get-GPO -All | %{
      $_ | Get-GPOReport -ReportType XML | Select-String "Impedir el acceso al símbolo del sistema"
    }
    ```

# Práctica
## Añadir un equipo al dominio desde PowerShell
* http://community.idera.com/powershell/powertips/b/tips/posts/joining-computers-to-a-domain
```
  - Delegación
  - Comandos
```PowerShell
# Buscar user
Get-ADObject -Filter 'ObjectClass -eq "user"' -SearchBase 'OU=usuariosPrueba,DC=Dominio,DC=Local'

# Añadir objeto contacto
New-ADObject -name Usuario -type contact -ProtectedFromAccidentalDeletion $true

# Añadir equipo
New-ADComputer -Name "PC-LAB-010" -Path "OU=Equipos,DC=empresa,DC=local" -Enabled $true

# Añadir equipo remotamente
$Cred = Get-Credential   # credencial con permisos para unir al dominio
$OU   = "OU=Equipos,DC=midominio,DC=local"
$pcs = Get-Content ".\equipos.txt"
foreach ($pc in $pcs) {
    Add-Computer -ComputerName $pc -DomainName "midominio.local" -OUPath $OU -Credential $Cred -Restart -Force
}

# Ver usuarios en OU
Get-ADUser -Path "OU=UnidadOrganizativa,DC=Dominio,DC=Local"

# Crear una OU
New-ADOrganizationalUnit -Name UnidadPS

# Crea un usuario en un lugar determinado
New-ADUSer -Name NombrePs -Sam NombreInicioSesion -Path "OU=UnidadPS,DC=jesusninoc,DC=com" -AccountPassword (ConvertTo-SecureString "Contra$ena" -AsPlainText -force) -Enable $true $SAMAccountName = "asir*" Get-ADUser -LDAPFilter "(samaccountname=$SAMAccountName)"
```
  - Permisos
  - Orden
- IIS
  - Instalación
    - https://www.jesusninoc.com/02/15/crear-un-sitio-en-iis-con-powershell/
    - https://www.jesusninoc.com/06/28/crear-una-maquina-virtual-en-azure-con-un-windows-server-y-un-internet-information-services-iis-desde-powershell/
  - Usuarios
    - https://www.jesusninoc.com/03/02/cambiar-la-autenticacion-en-un-sitio-web-del-iis-en-windows-10/
- Cliente Nagios
- Servidor Nagios
```Bash
docker pull jasonrivers/nagios:latest
docker run --name nagios4 -p 8080:80 jasonrivers/nagios:latest
# Acceso: http://IP:8080
# Credenciales por defecto: nagiosadmin / nagios
```

--------------
--------------

# Dominios
- LDAP en modelo TCP/IP y OSI http://www.mitlinx.de/ldap/assets/osi_ldap_dap.gif
- Administración del dominio y acceso al dominio https://www.jesusninoc.com/09/01/tecnico-superior-en-administracion-de-sistemas-informaticos-en-red/#Administracion_de_dominios_Implantacion_de_sistemas_operativos
- Filtros https://www.jesusninoc.com/07/05/utilizar-un-filtro-ldap-para-verificar-la-hora-del-ultimo-inicio-de-sesion-de-los-usuarios-del-active-directory/
- Herramientas para gestionar el AD https://sid-500.com/2018/03/25/active-directory-domain-services-section-tool-for-active-directory-administrators/

# PowerShell en Linux
- Scripts en Colab https://www.jesusninoc.com/01/17/instalar-powershell-en-google-colab/

- Azure
  - https://www.jesusninoc.com/06/28/instalacion-de-azure-powershell-en-windows-mediante-install-module/
  - https://www.jesusninoc.com/06/29/crea-un-nuevo-usuario-de-active-directory-en-azure/
  - https://www.jesusninoc.com/06/28/crear-una-maquina-virtual-con-un-windows-server-en-azure-desde-powershell/
  - https://www.jesusninoc.com/06/28/crear-una-maquina-virtual-en-azure-con-un-windows-server-y-un-internet-information-services-iis-desde-powershell/
  - https://www.jesusninoc.com/01/12/reconocer-emociones-de-las-caras-de-las-personas-que-hay-en-una-imagen-con-emotion-api-de-microsoft-azure/

```PowerShell
# Variables for common values
$resourceGroup = "myResourceGroup"
$location = "westeurope"
$vmName = "myVM"

# Create user object
$cred = Get-Credential -Message "Usuario y password para la máquina virtual"

# Simular creación del grupo de recursos (no lo crea)
New-AzResourceGroup -Name $resourceGroup -Location $location -WhatIf

# Simular creación de la máquina virtual y recursos asociados
New-AzVM `
  -ResourceGroupName $resourceGroup `
  -Name $vmName `
  -Location $location `
  -ImageName "Win2016Datacenter" `
  -VirtualNetworkName "myVnet" `
  -SubnetName "mySubnet" `
  -SecurityGroupName "myNetworkSecurityGroup" `
  -PublicIpAddressName "myPublicIp" `
  -Credential $cred `
  -OpenPorts 80 `
  -WhatIf
```
- Optimización de scripts
```Bash
nano monitor_servicios.sh
chmod 700 monitor_servicios.sh
sudo cat /var/log/monitor_servicios/monitor_servicios_$(date +%Y%m%d).log
# shellcheck
sudo apt-get update
sudo apt-get install -y shellcheck
shellcheck monitor_servicios.sh
```
```Bash
#!/bin/bash
# ---------------------------------------------------------
# Script : monitor_servicios.sh
# Propósito : Comprobar el estado de varios servicios,
#             generar un log y reiniciar los que fallen.
# Autor : (pon aquí tu nombre o "Alumno")
# Fecha : 2025-12-08
# ---------------------------------------------------------

# Ruta absoluta del directorio de logs
LOG_DIR="/var/log/monitor_servicios"
LOG_FILE="$LOG_DIR/monitor_servicios_$(/bin/date +%Y%m%d).log"

# Servicios a comprobar (cambiar por servicios reales del sistema)
SERVICIOS=("ssh" "cron" "apache2")

# Crear directorio de logs si no existe, con permisos restrictivos
if [ ! -d "$LOG_DIR" ]; then
  /bin/mkdir -p "$LOG_DIR"
  /bin/chmod 700 "$LOG_DIR"
fi

# Recorremos la lista de servicios
for servicio in "${SERVICIOS[@]}"; do
  FECHA=$(/bin/date "+%Y-%m-%d %H:%M:%S")
  ESTADO=$(/bin/systemctl is-active "$servicio" 2>/dev/null)

  if [ "$ESTADO" = "active" ]; then
    NIVEL="OK"
    MENSAJE="Servicio $servicio activo"
    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"
  elif [ -z "$ESTADO" ]; then
    NIVEL="UNKNOWN"
    MENSAJE="Servicio $servicio no existe o no está gestionado por systemd"
    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"
  else
    NIVEL="ERROR"
    MENSAJE="Servicio $servicio en estado '$ESTADO'. Intentando reinicio..."
    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"

    # Intentamos reiniciar el servicio
    /bin/systemctl restart "$servicio" 2>/dev/null
    NUEVO_ESTADO=$(/bin/systemctl is-active "$servicio" 2>/dev/null)
    FECHA=$(/bin/date "+%Y-%m-%d %H:%M:%S")

    if [ "$NUEVO_ESTADO" = "active" ]; then
      NIVEL="OK"
      MENSAJE="Servicio $servicio reiniciado correctamente"
    else
      NIVEL="CRITICAL"
      MENSAJE="No se pudo reiniciar el servicio $servicio (estado: '$NUEVO_ESTADO')"
    fi

    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"
  fi
done

exit 0
```
- Directorio Activo
- IIS

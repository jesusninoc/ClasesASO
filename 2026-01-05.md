- Tarea en el cron de copia de seguridad
```Bash
#!/bin/bash
# Actividad: Programación de backups automáticos en Linux
# Este script:
#  - Comprime /etc y /home
#  - Guarda el backup en /backups con la fecha en el nombre
#  - Registra el resultado en un archivo de log

# Directorio donde se guardan los backups
BACKUP_DIR="/backups"

# Archivo de log donde se registran los resultados
LOG="/var/log/backup_diario.log"

# Fecha en formato YYYY-MM-DD
FECHA=$(date +%F)

# Nombre del archivo de backup (tar.gz)
FICHERO="$BACKUP_DIR/backup-$FECHA.tar.gz"

# Crear la carpeta de backups si no existe
mkdir -p "$BACKUP_DIR"

# Comprimir /etc y /home en un solo fichero tar.gz
tar -czf "$FICHERO" /etc /home

# Comprobar si el comando anterior ha ido bien (código de salida 0 = OK)
if [ $? -eq 0 ]; then
    # Línea de log en caso de éxito
    echo "$(date): Backup correcto en $FICHERO" >> "$LOG"
else
    # Línea de log en caso de error
    echo "$(date): ERROR al crear el backup" >> "$LOG"
fi

# Ejemplo de línea de cron (para pegar en crontab de root con 'crontab -e'):
# 0 23 * * * /usr/local/sbin/backup_diario.sh
```
- Copias de seguridad de MySQL
  - https://www.jesusninoc.com/02/27/mysql-dump-completo/
  - https://www.jesusninoc.com/02/27/mysql-dump-ignorando-tablas/
- Monitorizar VM
```PowerShell
# Hyper-V: detectar máquinas detenidas y mostrar una "alerta" simple
$stoppedVMs = Get-VM | Where-Object State -eq 'Off'

if ($stoppedVMs) {
    $stoppedVMs | ForEach-Object {
        Write-Warning "La VM de Hyper-V '$($_.Name)' está detenida."
    }

    # Aquí podrías añadir:
    # - Enviar un correo
    # - Escribir en el Visor de eventos
    # - Lanzar un popup, etc.
}
```
```PowerShell
# --- Localiza VBoxManage (Windows) ---
$vboxmanage = Join-Path ${env:ProgramFiles} "Oracle\VirtualBox\VBoxManage.exe"
if (-not (Test-Path $vboxmanage)) {
    # Alternativa: si está en PATH
    $cmd = Get-Command VBoxManage.exe -ErrorAction SilentlyContinue
    if ($cmd) { $vboxmanage = $cmd.Source }
}

if (-not (Test-Path $vboxmanage)) {
    Write-Error "No se ha encontrado VBoxManage. Instala VirtualBox o añade VBoxManage al PATH."
    return
}

# --- 1) ¿Hay alguna VM corriendo? ---
$runningRaw = & $vboxmanage list runningvms 2>$null

if (-not $runningRaw -or $runningRaw.Count -eq 0) {
    "No hay máquinas virtuales en ejecución."
} else {
    "Máquinas virtuales en ejecución:"
    $runningRaw
}

# --- 2) Función: comprobar si una VM concreta está en ejecución ---
function Test-VBoxVMRunning {
    param(
        [Parameter(Mandatory)]
        [string]$NameOrUuid
    )

    $info = & $vboxmanage showvminfo $NameOrUuid --machinereadable 2>$null
    if (-not $info) { return $false }

    $stateLine = $info | Where-Object { $_ -like 'VMState=*' } | Select-Object -First 1
    if (-not $stateLine) { return $false }

    $state = ($stateLine -split '=',2)[1].Trim('"')
    return ($state -eq 'running')
}

# Ejemplo:
# Test-VBoxVMRunning -NameOrUuid "Ubuntu-Server"
```
- Azure
  - https://www.jesusninoc.com/06/28/instalacion-de-azure-powershell-en-windows-mediante-install-module/
  - https://www.jesusninoc.com/06/29/crea-un-nuevo-usuario-de-active-directory-en-azure/
  - https://www.jesusninoc.com/06/28/crear-una-maquina-virtual-con-un-windows-server-en-azure-desde-powershell/
  - https://www.jesusninoc.com/06/28/crear-una-maquina-virtual-en-azure-con-un-windows-server-y-un-internet-information-services-iis-desde-powershell/
  - https://www.jesusninoc.com/01/12/reconocer-emociones-de-las-caras-de-las-personas-que-hay-en-una-imagen-con-emotion-api-de-microsoft-azure/

```PowerShell
# Variables for common values
$resourceGroup = "myResourceGroup"
$location = "westeurope"
$vmName = "myVM"

# Create user object
$cred = Get-Credential -Message "Usuario y password para la máquina virtual"

# Simular creación del grupo de recursos (no lo crea)
New-AzResourceGroup -Name $resourceGroup -Location $location -WhatIf

# Simular creación de la máquina virtual y recursos asociados
New-AzVM `
  -ResourceGroupName $resourceGroup `
  -Name $vmName `
  -Location $location `
  -ImageName "Win2016Datacenter" `
  -VirtualNetworkName "myVnet" `
  -SubnetName "mySubnet" `
  -SecurityGroupName "myNetworkSecurityGroup" `
  -PublicIpAddressName "myPublicIp" `
  -Credential $cred `
  -OpenPorts 80 `
  -WhatIf
```
- Optimización de scripts
```Bash
nano monitor_servicios.sh
chmod 700 monitor_servicios.sh
sudo cat /var/log/monitor_servicios/monitor_servicios_$(date +%Y%m%d).log
# shellcheck
sudo apt-get update
sudo apt-get install -y shellcheck
shellcheck monitor_servicios.sh
```
```Bash
#!/bin/bash
# ---------------------------------------------------------
# Script : monitor_servicios.sh
# Propósito : Comprobar el estado de varios servicios,
#             generar un log y reiniciar los que fallen.
# Autor : (pon aquí tu nombre o "Alumno")
# Fecha : 2025-12-08
# ---------------------------------------------------------

# Ruta absoluta del directorio de logs
LOG_DIR="/var/log/monitor_servicios"
LOG_FILE="$LOG_DIR/monitor_servicios_$(/bin/date +%Y%m%d).log"

# Servicios a comprobar (cambiar por servicios reales del sistema)
SERVICIOS=("ssh" "cron" "apache2")

# Crear directorio de logs si no existe, con permisos restrictivos
if [ ! -d "$LOG_DIR" ]; then
  /bin/mkdir -p "$LOG_DIR"
  /bin/chmod 700 "$LOG_DIR"
fi

# Recorremos la lista de servicios
for servicio in "${SERVICIOS[@]}"; do
  FECHA=$(/bin/date "+%Y-%m-%d %H:%M:%S")
  ESTADO=$(/bin/systemctl is-active "$servicio" 2>/dev/null)

  if [ "$ESTADO" = "active" ]; then
    NIVEL="OK"
    MENSAJE="Servicio $servicio activo"
    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"
  elif [ -z "$ESTADO" ]; then
    NIVEL="UNKNOWN"
    MENSAJE="Servicio $servicio no existe o no está gestionado por systemd"
    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"
  else
    NIVEL="ERROR"
    MENSAJE="Servicio $servicio en estado '$ESTADO'. Intentando reinicio..."
    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"

    # Intentamos reiniciar el servicio
    /bin/systemctl restart "$servicio" 2>/dev/null
    NUEVO_ESTADO=$(/bin/systemctl is-active "$servicio" 2>/dev/null)
    FECHA=$(/bin/date "+%Y-%m-%d %H:%M:%S")

    if [ "$NUEVO_ESTADO" = "active" ]; then
      NIVEL="OK"
      MENSAJE="Servicio $servicio reiniciado correctamente"
    else
      NIVEL="CRITICAL"
      MENSAJE="No se pudo reiniciar el servicio $servicio (estado: '$NUEVO_ESTADO')"
    fi

    echo "[$FECHA] [$NIVEL] $MENSAJE" >> "$LOG_FILE"
  fi
done

exit 0
```
